"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[5138],{22658:function(t,a,e){var s=e(66252),r=e(24150),n=e(79940);class o{async createGroup(t){try{const a=await r.hi.post("/group/create",t,{headers:{"Content-type":"multipart/form-data"}});return a.data.data}catch(a){(0,s.S3)(a)}}async getAll(t,a){try{const e=await r.hi.get(`/group?page=${a}&name=${t}`);return await e.data}catch(e){return e}}async searchGroupByName(t){try{const a=await r.hi.get(`group/search-group-by-name/${t}`);return await a.data}catch(a){return a}}async getById(t){try{const a=await r.hi.get(`group/show/${t}`);return a.data.data}catch(a){return a}}async showBasicInfo(t){try{const a=await r.hi.get(`group/show-basic-info/${t}`);return a.data.data}catch(a){return a}}async getBooks(t){try{const a=await r.hi.get(`group/books/${t}`);return a.data.data}catch(a){(0,s.S3)(a)}}async getAllGroupExceptions(t){try{const a=await r.hi.get(`group/group-exceptions/${t}`);return a.data.data}catch(a){return a}}async exceptionsFilter(t,a){try{const e=await r.hi.get(`group/exceptions-filter/${t}/${a}`);return e.data.data}catch(e){return e}}async BasicMarksView(t,a){try{const e=await r.hi.get(`group/basic-mark-view/${t}/${a}`);return e.data.data}catch(e){return e}}async AllAchievements(t,a){try{const e=await r.hi.get(`group/all-achievements/${t}/${a}`);return e.data.data}catch(e){return e}}async AchievementAsPages(t,a){try{const e=await r.hi.get(`group/achievement-as-pages/${t}/${a}`);return e.data.data}catch(e){return e}}async searchForAmbassadorAchievement(t,a,e){try{const s=await r.hi.get(`group/search-for-ambassador-achievement/${t}/${a}/${e}`);return s.data.data}catch(s){return s}}async searchForAmbassador(t,a){try{const e=await r.hi.get(`group/search-for-ambassador/${t}/${a}`);return e.data.data}catch(e){return e}}async createLeaderRequest(t){try{const a=await r.hi.post("/group/create-leader-request",t,{headers:{"Content-type":"multipart/form-data"}});return a.data.data}catch(a){return a}}async lastLeaderRequest(t){try{const a=await r.hi.get(`group/last-leader-request/${t}`);return a.data.data}catch(a){return a}}async deleteById(t){try{return await r.hi.delete(`/group/delete/${t}`)}catch(a){return a}}async update(t){try{const a=await r.hi.post("/group/update",t,{headers:{"Content-type":"multipart/form-data"}});return a.data.data}catch(a){(0,s.S3)(a)}}async getGroupByType(t){try{const a=await r.hi.get(`/group/group-by-type/${t}`);return a.data.data}catch(a){return a}}async userGroups(t,a){try{const e=await r.hi.get(`/group/user-groups?page=${a}&name=${t}`);return e.data}catch(e){return e}}async statistics(t){try{const a=await r.hi.get(`group/statistics/${t}`);return a.data.data}catch(a){(0,n.F)(a,"statistics")}}async thesesAndScreensByWeek(t,a){try{const e=await r.hi.get(`group/theses-and-screens-by-week/${t}/${a}`);return e.data.data}catch(e){(0,s.S3)(e)}}async monthAchievement(t,a){try{const e=await r.hi.get(`group/month-achievement/${t}/${a}`);return e.data.data}catch(e){(0,s.S3)(e)}}async assignAdministrator(t){try{const a=await r.hi.post("/group/assign-administrator",t,{headers:{"Content-type":"multipart/form-data"}});return a.data.data}catch(a){(0,s.S3)(a)}}}a.Z=new o},79940:function(t,a,e){e.d(a,{F:function(){return r}});e(70560);var s=e(1120);function r(t,a=""){throw console.log(`[ERROR] ${a} =>`,t.response.data),404===t.response.data.statusCode?s.Z.push({name:"NotFound"}):403===t.response.data.statusCode&&s.Z.push({name:"NotAuthorized"}),t}},15138:function(t,a,e){e.r(a),e.d(a,{default:function(){return Z}});e(76265);var s=e(66252),r=e(3577),n=e(49963);const o=t=>((0,s.dD)("data-v-ddaae88c"),t=t(),(0,s.Cn)(),t),i={ref:"listContainer"},c={class:"row"},u={class:"col-sm-12"},d={key:0,class:"card-title"},l={key:1,class:"card-title"},h={class:"mt-3 inputs mb-3"},g=o((()=>(0,s._)("i",{class:"material-symbols-outlined"}," search ",-1))),p={key:0,class:"table-responsive"},m={id:"datatable",class:"table table-striped table-bordered"},y=o((()=>(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",null,"اسم المجموعة"),(0,s._)("th",null,"نوع المجموعة"),(0,s._)("th",null,"عدد الاعضاء")])],-1))),w={key:0},b=["onClick"],f={key:1},_=o((()=>(0,s._)("span",{class:"material-symbols-outlined align-middle"}," info ",-1))),v={key:2,class:"col-sm-12 text-center"},$=["src"];function k(t,a,o,k,C,A){const B=(0,s.up)("router-link"),M=(0,s.up)("iq-card");return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("div",c,[(0,s._)("div",u,[(0,s.Wm)(M,null,{headerTitle:(0,s.w5)((()=>[C.groups&&C.groups.length>0?((0,s.wg)(),(0,s.iD)("h4",d,"قائمة المجموعات - "+(0,r.zw)(C.groups.length),1)):((0,s.wg)(),(0,s.iD)("h4",l,"قائمة المجموعات - 0"))])),body:(0,s.w5)((()=>[(0,s._)("div",h,[g,(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",placeholder:" ... ابحث عن مجموعة","onUpdate:modelValue":a[0]||(a[0]=t=>C.searchModel=t),onKeyup:a[1]||(a[1]=(...a)=>t.debouncedSearch&&t.debouncedSearch(...a))},null,544),[[n.nr,C.searchModel,void 0,{trim:!0}]])]),(0,s.Wm)(B,{class:"mb-3 btn btn-primary float-end",to:{name:"group.addGroup"}},{default:(0,s.w5)((()=>[(0,s.Uk)(" اضافة مجموعة ")])),_:1},8,["to"]),C.groups&&C.groups.length>0?((0,s.wg)(),(0,s.iD)("div",p,[(0,s._)("table",m,[y,(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(C.groups,((t,a)=>((0,s.wg)(),(0,s.iD)("tr",{key:a},[(0,s._)("td",null,[(0,s.Wm)(B,{class:"text-center",to:{name:"group.group-detail",params:{group_id:t.id}}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,r.zw)(t.name),1)])),_:2},1032,["to"])]),(0,s._)("td",null,(0,r.zw)(C.group_type[t.type.type]),1),(0,s._)("td",null,(0,r.zw)(t.users_count),1),A.isAdmin?((0,s.wg)(),(0,s.iD)("td",w,[(0,s.Wm)(B,{class:"text-primary material-symbols-outlined ms-1 me-1",to:{name:"group.update",params:{group_id:t.id}}},{default:(0,s.w5)((()=>[(0,s.Uk)(" edit ")])),_:2},1032,["to"]),(0,s._)("span",{role:"button",onClick:a=>A.deleteGroup(t.id),class:"text-danger material-symbols-outlined ms-1 me-1"}," delete ",8,b)])):(0,s.kq)("",!0)])))),128))])])])):((0,s.wg)(),(0,s.iD)("div",f,[(0,s._)("h4",null,[(0,s.Uk)((0,r.zw)(C.emptyMessage)+" ",1),_])])),C.loading?((0,s.wg)(),(0,s.iD)("div",v,[(0,s._)("img",{src:e(79885),alt:"loader",style:{height:"100px"}},null,8,$)])):(0,s.kq)("",!0)])),_:1})])])],512)}var C=e(22658),A=e(8209),B=e(49579),M=e(9669),T=e.n(M),x={name:"Groups List",created(){this.debouncedSearch=this.debounce(this.loadGroups,300)},async mounted(){this.loadGroups(),window.addEventListener("scroll",this.handleScroll)},beforeUnmount(){window.removeEventListener("scroll",this.handleScroll),this.cancelToken.cancel()},data(){return{groups:[],group_type:{followup:"فريق متابعة",supervising:"فريق رقابة",advising:"فريق توجيه",consultation:"فريق الاستشارة",Administration:"الإدارة العليا"},searchModel:"",page:1,totalPages:1,loading:!1,pendingRequest:!1,hasMore:!0,emptyMessage:"",cancelToken:T().CancelToken.source()}},methods:{async deleteGroup(t){const a=this.$swal.mixin({customClass:{confirmButton:"btn btn-primary btn-lg",cancelButton:"btn btn-outline-primary btn-lg ms-2"},buttonsStyling:!1});a.fire({title:"هل أنت متأكد؟",text:"لا يمكنك التراجع عن هذا الاجراء",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، قم بالحذف",cancelButtonText:"تراجع  ",showClass:{popup:"animate__animated animate__zoomIn"},hideClass:{popup:"animate__animated animate__zoomOut"}}).then((async a=>{if(a.isConfirmed){await C.Z.deleteById(t).then((async t=>{const a=await C.Z.getAll();this.groups=a.data,A.Z.toggleToast("تم الحذف","success")})).catch((t=>{A.Z.toggleToast("حصل خطأ - لم يتم الحذف!","danger"),console.log(t)}))}}))},async loadGroups(){if(!this.pendingRequest){""==this.searchModel&&0==this.groups.length&&(this.page=1),""!=this.searchModel&&(this.page=1,this.groups=[]),this.pendingRequest=!0,this.loading=!0,this.emptyMessage="";try{var t,a;let e;if(e=await C.Z.getAll(this.searchModel,this.page,this.cancelToken),200!==e.statusCode)return void A.Z.toggleToast("حدث خطأ أثناء تحميل المجموعات, حاول مرة أخرى","error");if(200===e.statusCode&&!e.data)return this.emptyMessage="لا يوجد مجموعات",void(this.hasMore=!1);this.groups=[...this.groups,...e.data.groups.data],this.totalPages=null!==(t=null===(a=e.data)||void 0===a?void 0:a.last_page)&&void 0!==t?t:1,this.page++}catch(e){console.log(e),A.Z.toggleToast("حدث خطأ أثناء تحميل المجموعات, حاول مرة أخرى","error")}finally{this.loading=!1,this.pendingRequest=!1}}},isAtBottomOfPage(){const t=this.$refs.listContainer.getBoundingClientRect(),a=t.bottom,e=window.innerHeight;return a>=e},handleScroll(){this.hasMoreToLoad&&this.isAtBottomOfPage()&&this.loadGroups()},debounce(t,a){let e;return function(...s){clearTimeout(e),e=setTimeout((()=>{t.apply(this,s)}),a)}}},computed:{user(){return this.$store.getters.getUser},isAdmin(){return B.Z.hasRole(this.user,"admin")},hasMoreToLoad(){return this.page<=this.totalPages&&this.hasMore}}},S=e(83744);const G=(0,S.Z)(x,[["render",k],["__scopeId","data-v-ddaae88c"]]);var Z=G}}]);
//# sourceMappingURL=5138.b9a86ac7.js.map