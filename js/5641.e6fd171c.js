"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[5641],{9847:function(t,e,a){var s=a(66252),r=a(24150);class o{async userMonthAchievement(t,e){try{const a=await r.hi.get(`marks/user-month-achievement/${t}/${e}`);return a.data.data}catch(a){(0,s.S3)(a)}}async userWeekAchievement(t,e){try{const a=await r.hi.get(`marks/user-week-achievement/${t}/${e}`);return a.data.data}catch(a){(0,s.S3)(a)}}async ambassadorMark(t,e){try{const a=await r.hi.get(`marks/ambassador-mark/${t}/${e}`);return a.data.data}catch(a){(0,s.S3)(a)}}async acceptSupport(t,e){try{const a=await r.hi.put(`marks/accept-support/user/${t}/${e}`);return a.data}catch(a){(0,s.S3)(a)}}async rejectSupport(t,e){try{const a=await r.hi.put(`marks/reject-support/user/${t}/${e}`);return a.data}catch(a){(0,s.S3)(a)}}async setSupportMarkForAll(t){try{const e=await r.hi.post("/marks/set-support-for-all",t,{headers:{"Content-type":"multipart/form-data"}});return e.data.data}catch(e){(0,s.S3)(e)}}async topUsersByMonth(){try{const t=await r.hi.get("marks/top-users-by-month");return t.data.data}catch(t){(0,s.S3)(t)}}async topUsersByWeek(){try{const t=await r.hi.get("marks/top-users-by-week");return t.data.data}catch(t){(0,s.S3)(t)}}}e.Z=new o},2985:function(t,e,a){var s=a(66252),r=a(79940),o=a(24150);class n{async create(t){try{const e=await o.hi.post("/userexception/create",t,{headers:{"Content-type":"multipart/form-data"}});return e.data.data}catch(e){(0,s.S3)(e)}}async setExceptionalFreez(t){try{const e=await o.hi.post("/userexception/set-exceptional-freez",t,{headers:{"Content-type":"multipart/form-data"}});return e.data.data}catch(e){(0,s.S3)(e)}}async setNewUser(t){try{const e=await o.hi.post("/userexception/set-new-user",t,{headers:{"Content-type":"multipart/form-data"}});return e.data.data}catch(e){(0,s.S3)(e)}}async getExceptionById(t){try{const e=await o.hi.get(`userexception/show/${t}`);return e.data.data}catch(e){(0,r.F)(e)}}async update(t,e){try{const a=await o.hi.patch(`userexception/${t}`,e,{headers:{"Content-type":"multipart/form-data"}});return a.data.data}catch(a){return a}}async updateStatus(t,e){try{const a=await o.hi.patch(`userexception/update-status/${t}`,{decision:e.decision,note:e.note,week_id:e.week_id});return a.data.data}catch(a){return a}}async updateExceptionTypeById(t,e){try{return await o.hi.post("/userexception/update",{id:t,type:e})}catch(a){return a}}async cancelException(t){try{return await o.hi.get(`userexception/cancel/${t}`)}catch(e){return e}}async getAllUserExceptions(t){try{const e=await o.hi.get(`userexception/user-exceptions/${t}`);return e.data.data}catch(e){return e}}async exceptionsFilter(t,e){try{const a=await o.hi.get(`userexception/exceptions-filter/${t}/${e}`);return a.data.data}catch(a){return a}}}e.Z=new n},79940:function(t,e,a){a.d(e,{F:function(){return r}});a(70560);var s=a(1120);function r(t,e=""){throw console.log(`[ERROR] ${e} =>`,t.response.data),404===t.response.data.statusCode?s.Z.push({name:"NotFound"}):403===t.response.data.statusCode&&s.Z.push({name:"NotAuthorized"}),t}},88392:function(t,e,a){a.r(e),a.d(e,{default:function(){return ft}});a(76265);var s=a(66252),r=a(49963),o=a(3577),n=a(79885);const i={class:"col-sm-12 mt-3"},c={class:"iq-card-body p-3"},l={class:"d-flex align-items-center mt-3"},d={key:0,class:"col-12"},p={class:"card card-block card-stretch card-height blog"},u=(0,s._)("div",{class:"card-header"},[(0,s._)("h2",null,"اجراءات أخرى")],-1),m={class:"card-body"},h={class:"blog-description"},w={class:"form-group mt-3 mb-1"},k=(0,s._)("h4",null,"السبب",-1),g={class:"form-group row"},y={class:"mb-0"},b={key:0,class:"d-block text-start mt-1",style:{color:"red"}},_={class:"form-group"},x=["disabled"],v={class:"form-check mt-2 w-100 text-start"},f=["checked"],$=(0,s._)("h4",{class:"form-check-label",for:"allow_submit_is_new"}," هذا العضو جديد وفي اسبوعه الأول أو الثاني ",-1),S={class:"form-group"},F=["disabled"],C={key:0,class:"col-sm-12 text-center"},D=(0,s._)("img",{src:n,alt:"loader",style:{height:"100px"}},null,-1),N=[D],q={key:1,class:"text-center mt-3 mb-3"},E={class:"d-flex align-items-center mt-3 row"},M={class:"d-inline-block w-100 text-center col-12"},Z=(0,s._)("span",null,"إنجازات الفريق",-1),I=(0,s._)("span",{class:"align-middle material-symbols-outlined"}," keyboard_return ",-1);function z(t,e,a,n,D,z){const R=(0,s.up)("count-down"),U=(0,s.up)("AchievementCard"),B=(0,s.up)("Check"),j=(0,s.up)("Support"),A=(0,s.up)("router-link"),W=(0,s.up)("iq-card");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",i,[D.week?((0,s.wg)(),(0,s.j4)(R,{key:0,week:D.week,timer_type:"modify_timer"},null,8,["week"])):(0,s.kq)("",!0),D.mark?((0,s.wg)(),(0,s.j4)(W,{key:1,class:"iq-card"},{default:(0,s.w5)((()=>{var t;return[(0,s._)("div",c,[(0,s.Wm)(U,{mark:D.mark,group:D.group},null,8,["mark","group"]),(0,s._)("div",l,[(0,s.Wm)(B,{theses:D.theses},null,8,["theses"])]),(0,s.Wm)(j,{expired:D.expired,support:D.support,supportMark:null===(t=D.mark)||void 0===t?void 0:t.support,week:D.week,onUpdateSupportMark:z.updateSupportMark},null,8,["expired","support","supportMark","week","onUpdateSupportMark"]),D.expired?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",d,[(0,s._)("div",p,[u,(0,s._)("div",m,[(0,s._)("div",h,[(0,s._)("button",{class:"btn btn-danger mr-2 mt-1",onClick:e[0]||(e[0]=()=>{D.showExceptionForm=!D.showExceptionForm,D.showIsNewForm=!1})}," تجميد استثنائي "),z.isnew&&D.mark.reading_mark+D.mark.writing_mark+D.mark.support<=50?((0,s.wg)(),(0,s.iD)("button",{key:0,class:"btn btn-success ms-2 mt-1",onClick:e[1]||(e[1]=()=>{D.showIsNewForm=!D.showIsNewForm,D.showExceptionForm=!1})}," عضو جديد ")):(0,s.kq)("",!0)]),(0,s.wy)((0,s._)("form",{onSubmit:e[3]||(e[3]=(0,r.iM)(((...t)=>z.submitException&&z.submitException(...t)),["prevent"])),class:"post-text ml-3 w-100 row"},[(0,s._)("div",w,[k,(0,s._)("div",g,[(0,s.wy)((0,s._)("textarea",{rows:"5",placeholder:"سبب التجميد الاستثنائي",class:"rounded form-control mt-2 col-12",id:"exceptionReason","onUpdate:modelValue":e[2]||(e[2]=t=>n.v$.exceptionForm.reason.$model=t),name:"reason"},"\r\n                      ",512),[[r.nr,n.v$.exceptionForm.reason.$model]]),(0,s._)("p",y,[(0,s._)("span",{class:(0,o.C_)({"text-danger":n.v$.exceptionForm.reason.$error})},(0,o.zw)(n.v$.exceptionForm.reason.$model.length),3),(0,s.Uk)(" /250 ")])]),n.v$.exceptionForm.reason.$error?((0,s.wg)(),(0,s.iD)("small",b," * قم بادخال سبب لا ينقص عن 10 حروف ولا يزيد عن 250 حرف ")):(0,s.kq)("",!0)]),(0,s._)("div",_,[(0,s._)("button",{type:"submit",disabled:D.message,class:"btn d-block btn-primary float-end mx-auto"}," تجميد ",8,x)])],544),[[r.F8,D.showExceptionForm]]),(0,s.wy)((0,s._)("form",{onSubmit:e[5]||(e[5]=(0,r.iM)(((...t)=>z.submitIsNew&&z.submitIsNew(...t)),["prevent"])),class:"mt-3 post-text ml-3 w-100 row"},[(0,s._)("div",v,[(0,s._)("input",{type:"checkbox",checked:D.allowSubmitIsNew,class:"form-check-input",id:"allow_submit_is_new",ref:"allow_submit_is_new",onClick:e[4]||(e[4]=t=>D.allowSubmitIsNew=!D.allowSubmitIsNew)},null,8,f),$]),(0,s._)("div",S,[(0,s._)("button",{type:"submit",disabled:!D.allowSubmitIsNew,class:"btn d-block btn-primary float-end mx-auto"}," اعتماد عضو جديد ",8,F)])],544),[[r.F8,D.showIsNewForm]]),D.loader?((0,s.wg)(),(0,s.iD)("div",C,N)):(0,s.kq)("",!0),D.message?((0,s.wg)(),(0,s.iD)("h4",q,(0,o.zw)(D.message),1)):(0,s.kq)("",!0)])])])),(0,s._)("div",E,[(0,s._)("div",M,[D.group&&D.week?((0,s.wg)(),(0,s.j4)(A,{key:0,to:{name:"group.ambassadors-reading",params:{group_id:D.group.id,week_id:D.week.id}},class:"d-block mt-3 mb-3 w-75 mx-auto"},{default:(0,s.w5)((()=>[Z,I])),_:1},8,["to"])):(0,s.kq)("",!0)])])])]})),_:1})):(0,s.kq)("",!0)])])}a(278),a(70560);var R=a(74615),U=a(16319),B=a(9847),j=a(26667);const A=t=>((0,s.dD)("data-v-13cc3ae1"),t=t(),(0,s.Cn)(),t),W={class:"col-12"},O={class:"card card-block card-stretch card-height blog"},T=A((()=>(0,s._)("div",{class:"card-header"},[(0,s._)("h2",null,"اعرف مشروعك")],-1))),H={class:"card-body"},L={class:"blog-description"},V={key:0,class:"table w-100"},P=A((()=>(0,s._)("thead",null,[(0,s._)("tr",{class:"text-center"},[(0,s._)("th",{scope:"col"},"التفاعل"),(0,s._)("th",{scope:"col"},"التصويت"),(0,s._)("th",{scope:"col"},"المنشور"),(0,s._)("th",{scope:"col"},"العلامة"),(0,s._)("th",{scope:"col"},"التحكم")])],-1))),Y={class:"text-center"},K={key:0},G=["src","alt"],J=A((()=>(0,s._)("span",{class:"material-symbols-outlined",style:{"font-size":"1rem"}}," link ",-1))),Q=["rowspan"],X=A((()=>(0,s._)("span",{class:"text-danger-modified font-weight-600"},"لا يوجد دعم بعد",-1))),tt=[X],et=["rowspan"],at=["src"],st=["disabled"],rt=["disabled"],ot=A((()=>(0,s._)("tr",null,[(0,s._)("th",{colspan:"4"},"التعليقات")],-1))),nt={colspan:"4"},it={key:0,class:"rounded-pill badge bg-info px-2 ms-1"},ct={key:0,class:"text-center"},lt=A((()=>(0,s._)("td",{colspan:"3"},"لا يوجد تعليقات",-1))),dt=[lt],pt={class:"text-danger-modified font-weight-600",style:{direction:"rtl !important"}};function ut(t,e,r,n,i,c){var l;const d=(0,s.up)("font-awesome-icon"),p=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",W,[(0,s._)("div",O,[T,(0,s._)("div",H,[(0,s._)("div",L,[c.noSupportPost?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("table",V,[P,(0,s._)("tbody",null,[(0,s._)("tr",Y,[(0,s._)("td",null,[c.noReaction?((0,s.wg)(),(0,s.iD)("span",K,"لا يوجد")):"like"===r.support.reaction.type?((0,s.wg)(),(0,s.j4)(d,{key:1,icon:["fas","thumbs-up"],size:"xl",class:"text-primary"})):((0,s.wg)(),(0,s.iD)("img",{key:2,src:r.support.reaction.media.path,alt:r.support.reaction.type,class:"reaction-img",height:"20",width:"20"},null,8,G))]),(0,s._)("td",null,(0,o.zw)(c.noVote?"لا يوجد":r.support.vote.option),1),(0,s._)("td",null,[(0,s.Wm)(p,{to:{name:"osboha.post",params:{post_id:r.support.post_id,user_id:t.$route.params.ambassador_id}},class:"d-flex align-items-center justify-content-center"},{default:(0,s.w5)((()=>[J,(0,s.Uk)(" عرض ")])),_:1},8,["to"])]),(0,s._)("td",null,(0,o.zw)(r.supportMark),1),c.noReaction&&c.noVote&&c.noComments?((0,s.wg)(),(0,s.iD)("td",{key:0,rowspan:c.managementRowSpan,class:"align-middle"},tt,8,Q)):((0,s.wg)(),(0,s.iD)("td",{key:1,rowspan:c.managementRowSpan,class:"align-middle"},[i.loading?((0,s.wg)(),(0,s.iD)("img",{key:0,src:a(79885),alt:"loader",style:{height:"50px"}},null,8,at)):((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[0===r.supportMark?((0,s.wg)(),(0,s.iD)("button",{key:0,class:"btn btn-success",onClick:e[0]||(e[0]=(...t)=>c.handleSupport&&c.handleSupport(...t)),disabled:r.expired}," قبول ",8,st)):((0,s.wg)(),(0,s.iD)("button",{key:1,class:"btn btn-danger-modified",onClick:e[1]||(e[1]=t=>c.handleSupport(!1)),disabled:r.expired}," رفض ",8,rt))],64))],8,et))]),ot,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.support.comments,(t=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id},[(0,s._)("td",nt,[(0,s.Uk)((0,o.zw)(t.body)+" ",1),t.comment_id>0?((0,s.wg)(),(0,s.iD)("span",it,"رد ")):(0,s.kq)("",!0)])])))),128)),c.noComments?((0,s.wg)(),(0,s.iD)("tr",ct,dt)):(0,s.kq)("",!0)])])),(0,s._)("p",pt,(0,o.zw)(null===(l=r.support)||void 0===l?void 0:l.supportError),1)])])])])}var mt=a(8209),ht={name:"Support",props:{support:{type:Object,required:!0},week:{type:Object,required:!0},supportMark:{type:Number,default:0},expired:{type:Boolean,required:!0}},emits:["updateSupportMark"],data(){return{ambassador_id:this.$route.params.ambassador_id,loading:!1}},created(){},computed:{noSupportPost(){var t;return null!==(null===(t=this.support)||void 0===t?void 0:t.supportError)},noReaction(){var t;return null===(null===(t=this.support)||void 0===t?void 0:t.reaction)},noVote(){var t;return null===(null===(t=this.support)||void 0===t?void 0:t.vote)},noComments(){var t;return 0===(null===(t=this.support)||void 0===t||null===(t=t.comments)||void 0===t?void 0:t.length)},managementRowSpan(){var t;return this.noComments?3:(null===(t=this.support)||void 0===t||null===(t=t.comments)||void 0===t?void 0:t.length)+2}},methods:{async handleSupport(t=!0){if(this.loading)return;const e=t?"سيتم قبول انجاز اعرف مشروعك وإضافة العلامة للسفير":"سيتم رفض انجاز اعرف مشروعك وخصم العلامة من السفير",a=this.$swal.mixin({customClass:{confirmButton:"btn btn-primary btn-lg",cancelButton:"btn btn-outline-danger btn-lg ms-2"},buttonsStyling:!1});a.fire({title:"هل أنت متأكد؟",text:e,icon:"warning",showCancelButton:!0,confirmButtonText:"نعم!",cancelButtonText:"تراجع",showClass:{popup:"animate__animated animate__zoomIn"},hideClass:{popup:"animate__animated animate__zoomOut"}}).then((async e=>{if(e.isConfirmed){this.loading=!0;try{let e;if(e=t?await B.Z.acceptSupport(this.ambassador_id,this.week.id):await B.Z.rejectSupport(this.ambassador_id,this.week.id),200===e.statusCode){const e=t?"قبول":"رفض";mt.Z.toggleToast(`تم ${e} انجاز اعرف مشروعك بنجاح`,"success"),this.$emit("updateSupportMark",t?10:0)}}catch(a){console.log(a.response.data)}finally{this.loading=!1}}}))}}},wt=a(83744);const kt=(0,wt.Z)(ht,[["render",ut],["__scopeId","data-v-13cc3ae1"]]);var gt=kt,yt=a(2985),bt=a(5705),_t=a(10760),xt={name:"List Reading",components:{Check:U.Z,AchievementCard:R.Z,CountDown:j.Z,Support:gt},setup(){return{v$:(0,bt.ZP)()}},data(){return{theses:[],support:null,group:null,week:null,mark:null,exceptionForm:{reason:"",user_id:0,week_id:0},showExceptionForm:!1,showIsNewForm:!1,allowSubmitIsNew:!1,loader:!1,message:null,date:null,now:null,expired:!0}},async created(){try{const t=await B.Z.ambassadorMark(this.$route.params.ambassador_id,this.$route.params.week_id);this.mark=t.mark,this.theses=t.theses.reduce(((t,e)=>{const a=t[e.book.name]||[];return a["title"]=e.book.name,a.push(e),t[e.book.name]=a,t}),{}),this.group=t.group,this.week=t.currentWeek,this.support=t.support;const e=(new Date).toLocaleString("en-US",{timeZone:"Asia/Riyadh"});this.now=new Date(e),this.date=new Date(this.week.modify_timer),this.expired=this.time<0,this.expired||(this.exceptionForm.user_id=this.mark.user.id,this.exceptionForm.week_id=this.$route.params.week_id)}catch(t){const e=t.response.data;401===e.statusCode?this.$router.push({name:"NotAuthorized"}):404===e.statusCode?this.$router.push({name:"NotFound"}):mt.Z.toggleToast("حدث خطأ ما","error")}},validations(){return{exceptionForm:{reason:{required:_t.C1,minLength:(0,_t.Ei)(10),maxLength:(0,_t.BS)(250)}}}},methods:{updateSupportMark(t){this.mark.support=t},async submitException(){if(this.v$.$touch(),!this.v$.exceptionForm.$invalid){this.message="",this.loader=!0;try{const t=await yt.Z.setExceptionalFreez(this.exceptionForm);this.message=t,this.v$.exceptionForm.$reset()}catch(t){console.log("[Exception request error]",t)}finally{this.loader=!1}}},async submitIsNew(){this.message="",this.loader=!0;try{this.exceptionForm.reason="عضو جديد";const t=await yt.Z.setNewUser(this.exceptionForm);this.message=t,this.v$.exceptionForm.$reset()}catch(t){console.log("[submit new user error]",t)}finally{this.loader=!1}}},computed:{isnew(){if(this.mark){const t=new Date(this.mark.user.created_at),e=new Date,a=new Date;return a.setDate(e.getDate()-14),a.setHours(0,0,0,0),t.setHours(0,0,0,0),t>=a&&t<=e}return!1},time(){return this.date-this.now}}};const vt=(0,wt.Z)(xt,[["render",z]]);var ft=vt}}]);
//# sourceMappingURL=5641.e6fd171c.js.map