"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[5138],{15138:function(e,t,n){n.r(t),n.d(t,{default:function(){return U}});var r=n(66252),a=n(3577),o=n(49963),s=function(e){return(0,r.dD)("data-v-ddaae88c"),e=e(),(0,r.Cn)(),e},i={ref:"listContainer"},u={class:"row"},l={class:"col-sm-12"},c={key:0,class:"card-title"},d={key:1,class:"card-title"},p={class:"mt-3 inputs mb-3"},g=s((function(){return(0,r._)("i",{class:"material-symbols-outlined"}," search ",-1)})),h={key:0,class:"table-responsive"},f={id:"datatable",class:"table table-striped table-bordered"},m=s((function(){return(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",null,"اسم المجموعة"),(0,r._)("th",null,"نوع المجموعة"),(0,r._)("th",null,"عدد الاعضاء")])],-1)})),w={key:0},b=["onClick"],v={key:1},y=s((function(){return(0,r._)("span",{class:"material-symbols-outlined align-middle"}," info ",-1)})),_={key:2,class:"col-sm-12 text-center"},k=["src"];function Z(e,t,s,Z,x,C){var T=(0,r.up)("router-link"),M=(0,r.up)("iq-card");return(0,r.wg)(),(0,r.iD)("div",i,[(0,r._)("div",u,[(0,r._)("div",l,[(0,r.Wm)(M,null,{headerTitle:(0,r.w5)((function(){return[x.groups&&x.groups.length>0?((0,r.wg)(),(0,r.iD)("h4",c,"قائمة المجموعات - "+(0,a.zw)(x.groups.length),1)):((0,r.wg)(),(0,r.iD)("h4",d,"قائمة المجموعات - 0"))]})),body:(0,r.w5)((function(){return[(0,r._)("div",p,[g,(0,r.wy)((0,r._)("input",{type:"text",class:"form-control",placeholder:" ... ابحث عن مجموعة","onUpdate:modelValue":t[0]||(t[0]=function(e){return x.searchModel=e}),onKeyup:t[1]||(t[1]=function(){return e.debouncedSearch&&e.debouncedSearch.apply(e,arguments)})},null,544),[[o.nr,x.searchModel,void 0,{trim:!0}]])]),(0,r.Wm)(T,{class:"mb-3 btn btn-primary float-end",to:{name:"group.addGroup"}},{default:(0,r.w5)((function(){return[(0,r.Uk)(" اضافة مجموعة ")]})),_:1},8,["to"]),x.groups&&x.groups.length>0?((0,r.wg)(),(0,r.iD)("div",h,[(0,r._)("table",f,[m,(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(x.groups,(function(e,t){return(0,r.wg)(),(0,r.iD)("tr",{key:t},[(0,r._)("td",null,[(0,r.Wm)(T,{class:"text-center",to:{name:"group.group-detail",params:{group_id:e.id}}},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(e.name),1)]})),_:2},1032,["to"])]),(0,r._)("td",null,(0,a.zw)(x.group_type[e.type.type]),1),(0,r._)("td",null,(0,a.zw)(e.users_count),1),C.isAdmin?((0,r.wg)(),(0,r.iD)("td",w,[(0,r.Wm)(T,{class:"text-primary material-symbols-outlined ms-1 me-1",to:{name:"group.update",params:{group_id:e.id}}},{default:(0,r.w5)((function(){return[(0,r.Uk)(" edit ")]})),_:2},1032,["to"]),(0,r._)("span",{role:"button",onClick:function(t){return C.deleteGroup(e.id)},class:"text-danger material-symbols-outlined ms-1 me-1"}," delete ",8,b)])):(0,r.kq)("",!0)])})),128))])])])):((0,r.wg)(),(0,r.iD)("div",v,[(0,r._)("h4",null,[(0,r.Uk)((0,a.zw)(x.emptyMessage)+" ",1),y])])),x.loading?((0,r.wg)(),(0,r.iD)("div",_,[(0,r._)("img",{src:n(79885),alt:"loader",style:{height:"100px"}},null,8,k)])):(0,r.kq)("",!0)]})),_:1})])])],512)}var x=n(89584),C=n(50124),T=n(48534),M=(n(34338),n(22658)),A=n(31025),D=n(49579),S=n(9669),B=n.n(S),G={name:"Groups List",created:function(){this.debouncedSearch=this.debounce(this.loadGroups,300)},mounted:function(){var e=this;return(0,T.Z)((0,C.Z)().mark((function t(){return(0,C.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.loadGroups(),window.addEventListener("scroll",e.handleScroll);case 2:case"end":return t.stop()}}),t)})))()},beforeUnmount:function(){window.removeEventListener("scroll",this.handleScroll),this.cancelToken.cancel()},data:function(){return{groups:[],group_type:{followup:"فريق متابعة",supervising:"فريق رقابة",advising:"فريق توجيه",consultation:"فريق الاستشارة",Administration:"الإدارة العليا"},searchModel:"",page:1,totalPages:1,loading:!1,pendingRequest:!1,hasMore:!0,emptyMessage:"",cancelToken:B().CancelToken.source()}},methods:{deleteGroup:function(e){var t=this;return(0,T.Z)((0,C.Z)().mark((function n(){var r;return(0,C.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=t.$swal.mixin({customClass:{confirmButton:"btn btn-primary btn-lg",cancelButton:"btn btn-outline-primary btn-lg ms-2"},buttonsStyling:!1}),r.fire({title:"هل أنت متأكد؟",text:"لا يمكنك التراجع عن هذا الاجراء",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم، قم بالحذف",cancelButtonText:"تراجع  ",showClass:{popup:"animate__animated animate__zoomIn"},hideClass:{popup:"animate__animated animate__zoomOut"}}).then(function(){var n=(0,T.Z)((0,C.Z)().mark((function n(r){return(0,C.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!r.isConfirmed){n.next=4;break}return n.next=3,M.Z.deleteById(e).then(function(){var e=(0,T.Z)((0,C.Z)().mark((function e(n){var r;return(0,C.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,M.Z.getAll();case 2:r=e.sent,t.groups=r.data,A.Z.toggleToast("تم الحذف","success");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){A.Z.toggleToast("حصل خطأ - لم يتم الحذف!","danger"),console.log(e)}));case 3:n.sent;case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 2:case"end":return n.stop()}}),n)})))()},loadGroups:function(){var e=this;return(0,T.Z)((0,C.Z)().mark((function t(){var n,r,a;return(0,C.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.pendingRequest){t.next=2;break}return t.abrupt("return");case 2:return""==e.searchModel&&0==e.groups.length&&(e.page=1),""!=e.searchModel&&(e.page=1,e.groups=[]),e.pendingRequest=!0,e.loading=!0,e.emptyMessage="",t.prev=7,t.next=10,M.Z.getAll(e.searchModel,e.page,e.cancelToken);case 10:if(a=t.sent,200===a.statusCode){t.next=14;break}return A.Z.toggleToast("حدث خطأ أثناء تحميل المجموعات, حاول مرة أخرى","error"),t.abrupt("return");case 14:if(200!==a.statusCode||a.data){t.next=18;break}return e.emptyMessage="لا يوجد مجموعات",e.hasMore=!1,t.abrupt("return");case 18:e.groups=[].concat((0,x.Z)(e.groups),(0,x.Z)(a.data.groups.data)),e.totalPages=null!==(n=null===(r=a.data)||void 0===r?void 0:r.last_page)&&void 0!==n?n:1,e.page++,t.next=27;break;case 23:t.prev=23,t.t0=t["catch"](7),console.log(t.t0),A.Z.toggleToast("حدث خطأ أثناء تحميل المجموعات, حاول مرة أخرى","error");case 27:return t.prev=27,e.loading=!1,e.pendingRequest=!1,t.finish(27);case 31:case"end":return t.stop()}}),t,null,[[7,23,27,31]])})))()},isAtBottomOfPage:function(){var e=this.$refs.listContainer.getBoundingClientRect(),t=e.bottom,n=window.innerHeight;return t>=n},handleScroll:function(){this.hasMoreToLoad&&this.isAtBottomOfPage()&&this.loadGroups()},debounce:function(e,t){var n;return function(){for(var r=this,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];clearTimeout(n),n=setTimeout((function(){e.apply(r,o)}),t)}}},computed:{user:function(){return this.$store.getters.getUser},isAdmin:function(){return D.Z.hasRole(this.user,"admin")},hasMoreToLoad:function(){return this.page<=this.totalPages&&this.hasMore}}},q=n(83744);const z=(0,q.Z)(G,[["render",Z],["__scopeId","data-v-ddaae88c"]]);var U=z},89584:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(49227);function a(e){if(Array.isArray(e))return(0,r.Z)(e)}n(59749),n(86544),n(60228),n(84254),n(21694),n(76265),n(77049);function o(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var s=n(12780);n(21057);function i(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e){return a(e)||o(e)||(0,s.Z)(e)||i()}}}]);
//# sourceMappingURL=5138-legacy.62fa5bba.js.map